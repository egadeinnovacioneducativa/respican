import React, { useState, useEffect, useRef } from 'react';

// --- ICONOS SVG (Integrados para no depender de librerías externas) ---
const IconPaw = ({ size = 24, color = "currentColor" }) => (
  <svg width={size} height={size} viewBox="0 0 24 24" fill={color} xmlns="http://www.w3.org/2000/svg">
    <path d="M12 2C10.9 2 10 2.9 10 4C10 5.1 10.9 6 12 6C13.1 6 14 5.1 14 4C14 2.9 13.1 2 12 2ZM7 5C5.9 5 5 5.9 5 7C5 8.1 5.9 9 7 9C8.1 9 9 8.1 9 7C9 5.9 8.1 5 7 5ZM17 5C15.9 5 15 5.9 15 7C15 8.1 15.9 9 17 9C18.1 9 19 8.1 19 7C19 5.9 18.1 5 17 5ZM6.5 11C5.12 11 4 12.12 4 13.5C4 15.5 6 19 10 21C10.8 21.4 11.4 21.4 12.2 21C12.5 20.85 12.8 20.68 13.1 20.5C13.38 20.33 13.67 20.16 14 20.05C18 19 20 15.5 20 13.5C20 12.12 18.88 11 17.5 11C16.35 11 15.39 11.78 15.07 12.83L15 13L14 12.5C13.3 12.15 12.5 12 11.7 12C11.3 12 10.9 12.05 10.5 12.15C10.44 12.17 10.38 12.18 10.32 12.2L10 12.3L9.8 12C9.3 11.4 8.6 11 7.8 11C7.35 11 6.91 11.17 6.5 11.48V11H6.5Z" />
  </svg>
);

const IconPlay = ({ size = 24, color = "currentColor" }) => (
  <svg width={size} height={size} viewBox="0 0 24 24" fill={color} xmlns="http://www.w3.org/2000/svg">
    <path d="M8 5V19L19 12L8 5Z" />
  </svg>
);

const IconRotate = ({ size = 24, color = "currentColor" }) => (
  <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
    <path d="M3 3v5h5" />
  </svg>
);

const IconHeart = ({ size = 24, color = "currentColor" }) => (
  <svg width={size} height={size} viewBox="0 0 24 24" fill={color} xmlns="http://www.w3.org/2000/svg">
    <path d="M12 21.35L10.55 20.03C5.4 15.36 2 12.27 2 8.5C2 5.41 4.42 3 7.5 3C9.24 3 10.91 3.81 12 5.08C13.09 3.81 14.76 3 16.5 3C19.58 3 22 5.41 22 8.5C22 12.27 18.6 15.36 13.45 20.03L12 21.35Z" />
  </svg>
);

const IconClock = ({ size = 24, color = "currentColor" }) => (
  <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
    <circle cx="12" cy="12" r="10" />
    <polyline points="12 6 12 12 16 14" />
  </svg>
);

export default function App() {
  const [gameState, setGameState] = useState('idle'); // 'idle', 'counting', 'finished'
  const [timeLeft, setTimeLeft] = useState(10);
  const [count, setCount] = useState(0);
  const [isPressed, setIsPressed] = useState(false);
  const timerRef = useRef(null);

  // Colores definidos en JS para asegurar que se apliquen
  const colors = {
    amber50: '#fffbeb',
    amber100: '#fef3c7',
    amber200: '#fde68a',
    amber500: '#f59e0b',
    amber600: '#d97706',
    amber800: '#92400e',
    amber900: '#78350f',
    orange500: '#f97316',
    green400: '#4ade80',
    emerald600: '#059669',
    emerald700: '#047857',
    white: '#ffffff',
    red100: '#fee2e2',
    red500: '#ef4444',
  };

  useEffect(() => {
    if (gameState === 'counting' && timeLeft > 0) {
      timerRef.current = setInterval(() => {
        setTimeLeft((prev) => prev - 1);
      }, 1000);
    } else if (timeLeft === 0) {
      finishCounting();
    }
    return () => clearInterval(timerRef.current);
  }, [gameState, timeLeft]);

  const finishCounting = () => {
    clearInterval(timerRef.current);
    setGameState('finished');
  };

  const handleInteraction = () => {
    // Animación simple manual
    setIsPressed(true);
    setTimeout(() => setIsPressed(false), 100);

    if (gameState === 'idle') {
      setGameState('counting');
      setCount(0);
      setTimeLeft(10);
    } else if (gameState === 'counting') {
      setCount((prev) => prev + 1);
    }
  };

  const resetApp = () => {
    setGameState('idle');
    setCount(0);
    setTimeLeft(10);
  };

  const breathsPerMinute = count * 6;

  // Estilos en línea para garantizar el diseño sin Tailwind
  const styles = {
    container: {
      minHeight: '100vh',
      backgroundColor: colors.amber50,
      fontFamily: 'system-ui, -apple-system, sans-serif',
      display: 'flex',
      flexDirection: 'column',
      alignItems: 'center',
      justifyContent: 'center',
      padding: '20px',
      overflow: 'hidden',
      userSelect: 'none',
      WebkitTapHighlightColor: 'transparent',
    },
    header: {
      position: 'absolute',
      top: '20px',
      width: '100%',
      textAlign: 'center',
    },
    headerTitle: {
      fontSize: '28px',
      fontWeight: '900',
      color: colors.amber800,
      display: 'flex',
      justifyContent: 'center',
      alignItems: 'center',
      gap: '10px',
      margin: '0',
    },
    headerSubtitle: {
      color: colors.amber800,
      fontSize: '14px',
      marginTop: '5px',
      opacity: 0.8,
    },
    mainArea: {
      flex: 1,
      display: 'flex',
      flexDirection: 'column',
      alignItems: 'center',
      justifyContent: 'center',
      width: '100%',
      maxWidth: '400px',
    },
    timerBadge: {
      marginBottom: '30px',
      display: 'flex',
      alignItems: 'center',
      gap: '8px',
      backgroundColor: colors.white,
      padding: '8px 24px',
      borderRadius: '50px',
      border: `2px solid ${colors.amber200}`,
      boxShadow: '0 2px 5px rgba(0,0,0,0.05)',
      opacity: gameState === 'counting' ? 1 : 0,
      transform: gameState === 'counting' ? 'translateY(0)' : 'translateY(-20px)',
      transition: 'all 0.3s ease',
    },
    timerText: {
      fontSize: '24px',
      fontFamily: 'monospace',
      fontWeight: 'bold',
      color: colors.amber600,
    },
    bigButton: {
      position: 'relative',
      width: '280px',
      height: '280px',
      borderRadius: '50%',
      border: 'none',
      outline: 'none',
      cursor: 'pointer',
      display: 'flex',
      flexDirection: 'column',
      alignItems: 'center',
      justifyContent: 'center',
      transition: 'transform 0.1s',
      transform: isPressed ? 'scale(0.95)' : 'scale(1)',
      background: gameState === 'idle' 
        ? `linear-gradient(135deg, ${colors.amber500}, ${colors.orange500})`
        : `linear-gradient(135deg, ${colors.green400}, ${colors.emerald600})`,
      boxShadow: gameState === 'counting'
        ? '0 10px 25px rgba(16, 185, 129, 0.4)'
        : '0 15px 30px rgba(245, 158, 11, 0.4)',
    },
    buttonInnerRing: {
      position: 'absolute',
      inset: '10px',
      borderRadius: '50%',
      border: '2px solid rgba(255,255,255,0.2)',
      pointerEvents: 'none',
    },
    buttonTextLarge: {
      fontSize: '36px',
      fontWeight: '900',
      color: colors.white,
      textShadow: '0 2px 4px rgba(0,0,0,0.2)',
      marginTop: '10px',
    },
    buttonTextSmall: {
      fontSize: '18px',
      fontWeight: 'bold',
      color: colors.amber100,
      textTransform: 'uppercase',
      letterSpacing: '1px',
    },
    card: {
      backgroundColor: colors.white,
      width: '100%',
      borderRadius: '24px',
      padding: '30px',
      border: `4px solid ${colors.amber200}`,
      textAlign: 'center',
      boxShadow: '0 10px 25px rgba(0,0,0,0.1)',
    },
    resultNumber: {
      fontSize: '64px',
      fontWeight: '900',
      color: colors.amber600,
      lineHeight: 1,
      marginBottom: '10px',
    },
    resultLabel: {
      color: colors.amber500,
      fontWeight: 'bold',
      fontSize: '18px',
      marginBottom: '25px',
    },
    summaryBox: {
      backgroundColor: colors.amber50,
      borderRadius: '12px',
      padding: '15px',
      textAlign: 'left',
      color: colors.amber900,
      marginBottom: '25px',
      fontSize: '14px',
    },
    actionButton: {
      width: '100%',
      backgroundColor: colors.amber500,
      color: colors.white,
      border: 'none',
      padding: '16px',
      borderRadius: '12px',
      fontSize: '18px',
      fontWeight: 'bold',
      cursor: 'pointer',
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      gap: '10px',
      boxShadow: '0 4px 12px rgba(245, 158, 11, 0.3)',
    },
    footer: {
      position: 'absolute',
      bottom: '20px',
      textAlign: 'center',
      color: colors.amber900,
      opacity: 0.5,
      fontSize: '12px',
      fontWeight: '600',
    }
  };

  return (
    <div style={styles.container}>
      
      {/* Header */}
      <div style={styles.header}>
        <h1 style={styles.headerTitle}>
          <IconPaw size={28} color={colors.amber600} />
          RespiCan
          <IconPaw size={28} color={colors.amber600} />
        </h1>
        <p style={styles.headerSubtitle}>Calculadora de Frecuencia</p>
      </div>

      {/* Área Principal */}
      <div style={styles.mainArea}>
        
        {/* Temporizador */}
        <div style={styles.timerBadge}>
          <IconClock size={20} color={colors.amber500} />
          <span style={styles.timerText}>
            00:{timeLeft < 10 ? `0${timeLeft}` : timeLeft}
          </span>
        </div>

        {/* Pantallas del Juego */}
        {gameState === 'finished' ? (
          // Pantalla de Resultados
          <div style={styles.card}>
            <div style={{ display: 'flex', justifyContent: 'center', marginBottom: '15px' }}>
              <div style={{ backgroundColor: colors.red100, padding: '15px', borderRadius: '50%' }}>
                <IconHeart size={40} color={colors.red500} />
              </div>
            </div>
            
            <h2 style={{ color: colors.amber900, fontSize: '20px', fontWeight: 'bold', margin: '0 0 10px 0' }}>
              Resultado Final
            </h2>
            <div style={styles.resultNumber}>
              {breathsPerMinute}
            </div>
            <div style={styles.resultLabel}>Respiraciones / min</div>
            
            <div style={styles.summaryBox}>
              <ul style={{ margin: 0, paddingLeft: '20px' }}>
                <li>Contaste <strong>{count}</strong> respiraciones.</li>
                <li>En <strong>10</strong> segundos.</li>
                <li>Multiplicador: <strong>x6</strong>.</li>
              </ul>
            </div>

            <button 
              onClick={resetApp}
              style={styles.actionButton}
            >
              <IconRotate size={24} color="white" />
              Medir de nuevo
            </button>
          </div>
        ) : (
          // Botón Gigante Interactivo
          <button
            onClick={handleInteraction}
            style={styles.bigButton}
          >
            <div style={styles.buttonInnerRing}></div>

            {gameState === 'idle' ? (
              <>
                <IconPlay size={64} color="white" />
                <span style={{...styles.buttonTextSmall, color: 'white', marginTop: '10px'}}>INICIAR</span>
              </>
            ) : (
              <>
                <IconPaw size={70} color="rgba(255,255,255,0.9)" />
                <span style={styles.buttonTextSmall}>¡PRESIONA!</span>
                <span style={styles.buttonTextLarge}>{count}</span>
              </>
            )}
          </button>
        )}
      </div>

      {/* Pie de página */}
      <div style={styles.footer}>
        Toca el botón cada vez que el pecho suba
      </div>
    </div>
  );
}

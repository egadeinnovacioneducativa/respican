import React, { useState, useEffect, useRef } from 'react';

// --- ICONOS SVG (Estilos en línea para asegurar visualización) ---
const IconPaw = ({ size = 24, color = "#d97706" }) => (
  <svg width={size} height={size} viewBox="0 0 24 24" fill={color} xmlns="http://www.w3.org/2000/svg" style={{ display: 'block' }}>
    <path d="M12 2C10.9 2 10 2.9 10 4C10 5.1 10.9 6 12 6C13.1 6 14 5.1 14 4C14 2.9 13.1 2 12 2ZM7 5C5.9 5 5 5.9 5 7C5 8.1 5.9 9 7 9C8.1 9 9 8.1 9 7C9 5.9 8.1 5 7 5ZM17 5C15.9 5 15 5.9 15 7C15 8.1 15.9 9 17 9C18.1 9 19 8.1 19 7C19 5.9 18.1 5 17 5ZM6.5 11C5.12 11 4 12.12 4 13.5C4 15.5 6 19 10 21C10.8 21.4 11.4 21.4 12.2 21C12.5 20.85 12.8 20.68 13.1 20.5C13.38 20.33 13.67 20.16 14 20.05C18 19 20 15.5 20 13.5C20 12.12 18.88 11 17.5 11C16.35 11 15.39 11.78 15.07 12.83L15 13L14 12.5C13.3 12.15 12.5 12 11.7 12C11.3 12 10.9 12.05 10.5 12.15C10.44 12.17 10.38 12.18 10.32 12.2L10 12.3L9.8 12C9.3 11.4 8.6 11 7.8 11C7.35 11 6.91 11.17 6.5 11.48V11H6.5Z" />
  </svg>
);

const IconPlay = ({ size = 24, color = "#ffffff" }) => (
  <svg width={size} height={size} viewBox="0 0 24 24" fill={color} xmlns="http://www.w3.org/2000/svg" style={{ display: 'block' }}>
    <path d="M8 5V19L19 12L8 5Z" />
  </svg>
);

const IconRotate = ({ size = 24, color = "#ffffff" }) => (
  <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={{ display: 'block' }}>
    <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
    <path d="M3 3v5h5" />
  </svg>
);

const IconHeart = ({ size = 24, color = "#ef4444" }) => (
  <svg width={size} height={size} viewBox="0 0 24 24" fill={color} xmlns="http://www.w3.org/2000/svg" style={{ display: 'block' }}>
    <path d="M12 21.35L10.55 20.03C5.4 15.36 2 12.27 2 8.5C2 5.41 4.42 3 7.5 3C9.24 3 10.91 3.81 12 5.08C13.09 3.81 14.76 3 16.5 3C19.58 3 22 5.41 22 8.5C22 12.27 18.6 15.36 13.45 20.03L12 21.35Z" />
  </svg>
);

const IconClock = ({ size = 24, color = "#f59e0b" }) => (
  <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" style={{ display: 'block' }}>
    <circle cx="12" cy="12" r="10" />
    <polyline points="12 6 12 12 16 14" />
  </svg>
);

export default function App() {
  const [gameState, setGameState] = useState('idle'); // 'idle', 'counting', 'finished'
  const [timeLeft, setTimeLeft] = useState(10);
  const [count, setCount] = useState(0);
  const [isPressed, setIsPressed] = useState(false);
  const timerRef = useRef(null);

  // PALETA DE COLORES SEGURA (Hexadecimales directos)
  const C = {
    bg: '#fff7ed', // Fondo un poco más oscuro (naranja muy pálido)
    primary: '#f97316', // Naranja
    secondary: '#ea580c', // Naranja oscuro
    success: '#22c55e', // Verde
    successDark: '#15803d',
    white: '#ffffff',
    text: '#7c2d12', // Marrón
    textLight: '#fdba74',
    border: '#fed7aa',
  };

  useEffect(() => {
    if (gameState === 'counting' && timeLeft > 0) {
      timerRef.current = setInterval(() => {
        setTimeLeft((prev) => prev - 1);
      }, 1000);
    } else if (timeLeft === 0) {
      finishCounting();
    }
    return () => clearInterval(timerRef.current);
  }, [gameState, timeLeft]);

  const finishCounting = () => {
    clearInterval(timerRef.current);
    setGameState('finished');
  };

  const handleInteraction = () => {
    setIsPressed(true);
    setTimeout(() => setIsPressed(false), 100);

    if (gameState === 'idle') {
      setGameState('counting');
      setCount(0);
      setTimeLeft(10);
    } else if (gameState === 'counting') {
      setCount((prev) => prev + 1);
    }
  };

  const resetApp = () => {
    setGameState('idle');
    setCount(0);
    setTimeLeft(10);
  };

  const breathsPerMinute = count * 6;

  // Estilos en objeto JS puro para evitar errores de carga de CSS
  const s = {
    container: {
      minHeight: '100vh',
      backgroundColor: C.bg,
      fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif',
      display: 'flex',
      flexDirection: 'column',
      alignItems: 'center',
      justifyContent: 'center',
      padding: '20px',
      overflow: 'hidden',
      userSelect: 'none',
      WebkitUserSelect: 'none',
      position: 'relative',
    },
    header: {
      position: 'absolute',
      top: '20px',
      width: '100%',
      display: 'flex',
      flexDirection: 'column',
      alignItems: 'center',
    },
    title: {
      fontSize: '28px',
      fontWeight: '900',
      color: C.text,
      display: 'flex',
      alignItems: 'center',
      gap: '10px',
      margin: 0,
    },
    subtitle: {
      color: C.text,
      fontSize: '14px',
      marginTop: '4px',
      opacity: 0.8,
    },
    main: {
      display: 'flex',
      flexDirection: 'column',
      alignItems: 'center',
      justifyContent: 'center',
      width: '100%',
    },
    timerBox: {
      marginBottom: '30px',
      display: 'flex',
      alignItems: 'center',
      gap: '10px',
      backgroundColor: C.white,
      padding: '10px 25px',
      borderRadius: '999px',
      border: `2px solid ${C.border}`,
      opacity: gameState === 'counting' ? 1 : 0,
      transform: gameState === 'counting' ? 'translateY(0)' : 'translateY(-10px)',
      transition: 'all 0.3s ease',
    },
    timerText: {
      fontSize: '24px',
      fontFamily: 'monospace',
      fontWeight: 'bold',
      color: C.secondary,
    },
    // El botón gigante principal
    bigButton: {
      width: '260px',
      height: '260px',
      borderRadius: '50%',
      border: 'none',
      cursor: 'pointer',
      display: 'flex',
      flexDirection: 'column',
      alignItems: 'center',
      justifyContent: 'center',
      transition: 'transform 0.1s',
      transform: isPressed ? 'scale(0.96)' : 'scale(1)',
      background: gameState === 'idle' 
        ? `linear-gradient(145deg, ${C.primary}, ${C.secondary})`
        : `linear-gradient(145deg, ${C.success}, ${C.successDark})`,
      boxShadow: gameState === 'counting'
        ? '0 10px 30px rgba(34, 197, 94, 0.4)' // Sombra verde
        : '0 10px 30px rgba(234, 88, 12, 0.4)', // Sombra naranja
      position: 'relative',
      outline: 'none',
      WebkitTapHighlightColor: 'transparent',
    },
    buttonRing: {
      position: 'absolute',
      top: '10px', left: '10px', right: '10px', bottom: '10px',
      borderRadius: '50%',
      border: '2px solid rgba(255,255,255,0.3)',
      pointerEvents: 'none',
    },
    btnTextMain: {
      fontSize: '18px',
      fontWeight: '800',
      color: 'rgba(255,255,255,0.9)',
      textTransform: 'uppercase',
      marginTop: '12px',
      letterSpacing: '1px',
    },
    btnCount: {
      fontSize: '48px',
      fontWeight: '900',
      color: C.white,
      marginTop: '0px',
      textShadow: '0 2px 10px rgba(0,0,0,0.2)',
    },
    // Tarjeta de resultados
    resultCard: {
      backgroundColor: C.white,
      padding: '30px',
      borderRadius: '20px',
      border: `4px solid ${C.border}`,
      textAlign: 'center',
      width: '100%',
      maxWidth: '320px',
      boxShadow: '0 10px 40px rgba(0,0,0,0.1)',
    },
    resultBig: {
      fontSize: '60px',
      fontWeight: '900',
      color: C.secondary,
      lineHeight: '1',
      margin: '10px 0',
    },
    resultLabel: {
      color: C.primary,
      fontWeight: 'bold',
      fontSize: '18px',
      marginBottom: '20px',
    },
    list: {
      backgroundColor: C.bg,
      borderRadius: '12px',
      padding: '15px 20px',
      textAlign: 'left',
      fontSize: '14px',
      color: C.text,
      marginBottom: '25px',
      listStylePosition: 'inside',
    },
    resetBtn: {
      backgroundColor: C.primary,
      color: C.white,
      border: 'none',
      width: '100%',
      padding: '15px',
      borderRadius: '12px',
      fontSize: '16px',
      fontWeight: 'bold',
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      gap: '8px',
      cursor: 'pointer',
      boxShadow: '0 4px 15px rgba(249, 115, 22, 0.3)',
    },
    footer: {
      position: 'absolute',
      bottom: '20px',
      fontSize: '12px',
      color: C.text,
      opacity: 0.6,
      textAlign: 'center',
      width: '100%',
    }
  };

  return (
    <div style={s.container}>
      
      {/* Encabezado */}
      <div style={s.header}>
        <h1 style={s.title}>
          <IconPaw size={28} color={C.secondary} />
          RespiCan
          <IconPaw size={28} color={C.secondary} />
        </h1>
        <span style={s.subtitle}>Calculadora de Respiración</span>
      </div>

      {/* Área Central */}
      <div style={s.main}>
        
        {/* Indicador de Tiempo */}
        <div style={s.timerBox}>
          <IconClock size={20} color={C.primary} />
          <span style={s.timerText}>
            00:{timeLeft < 10 ? `0${timeLeft}` : timeLeft}
          </span>
        </div>

        {/* Pantallas */}
        {gameState === 'finished' ? (
          <div style={s.resultCard}>
            <div style={{ display: 'flex', justifyContent: 'center' }}>
              <div style={{ background: '#fee2e2', padding: '12px', borderRadius: '50%' }}>
                <IconHeart size={32} color={C.secondary} />
              </div>
            </div>
            
            <h2 style={{ color: C.text, margin: '15px 0 5px 0' }}>Resultado</h2>
            <div style={s.resultBig}>{breathsPerMinute}</div>
            <div style={s.resultLabel}>Respiraciones / min</div>
            
            <div style={s.list}>
              <div>• <strong>{count}</strong> respiraciones contadas</div>
              <div style={{ marginTop: '5px' }}>• En <strong>10</strong> segundos</div>
            </div>

            <button onClick={resetApp} style={s.resetBtn}>
              <IconRotate size={20} color="white" />
              Medir de nuevo
            </button>
          </div>
        ) : (
          <button 
            onClick={handleInteraction}
            style={s.bigButton}
          >
            <div style={s.buttonRing}></div>
            
            {gameState === 'idle' ? (
              <>
                <IconPlay size={60} color="white" />
                <span style={s.btnTextMain}>INICIAR</span>
              </>
            ) : (
              <>
                <IconPaw size={60} color="rgba(255,255,255,0.9)" />
                <span style={s.btnTextMain}>¡PRESIONA!</span>
                <div style={s.btnCount}>{count}</div>
              </>
            )}
          </button>
        )}

      </div>

      <div style={s.footer}>
        Presiona el botón cada vez que suba el pecho
      </div>
    </div>
  );
}
